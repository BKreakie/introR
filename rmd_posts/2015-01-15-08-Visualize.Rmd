---
title: "08 - Visualize"
author: Jeffrey W. Hollister
layout: post_page
---

```{r setup, echo=FALSE, warning=FALSE, purl=FALSE, message=FALSE}
options(repos="http://cran.rstudio.com/")
if(!require("ggplot2")){
  install.packages("ggplot2")
}
library("ggplot2")
library("dplyr")
```

One of the frequently touted strong points of R is data visualization.  We saw some of that with our use of base graphics, but those plots were, frankly, a bit pedestrian.  More and more though, users are moving away from base graphics and using the`ggplot2` package.  I would even go as far to say that it is almost become the default plotting mechanism in R.  This whole lesson we will focus on creating, modifying, and save plots with `ggplot2`.

##Quick Links to Exercises and R code
- [Lesson 8 R Code](/gedr/rmd_posts/2015-01-14-08-Visualize.R): All the code from this post in an R Script.
- [Exercise 1](#exercise-1): Create a number of styles of plots
- [Exercise 2](#exercise-2): Build a plot, using custom themes, and save as a jpeg.

##Lesson Goals
- Become familar with some basic plots in `ggplot2`
- Be able to manipulate the default themes
- Output plots to files
- Know where to get some help

A lot has been written and discussed about `ggplot2`.  In particular see [here](http://ggplot2.org/), [here](http://docs.ggplot2.org/current/) and [here](https://github.com/karthikram/ggplot-lecture).  The gist of all this, is that `ggplot2` is an implementation of something known as the "grammar of graphics."  This separates the basic components of a graphic into distinct parts (e.g. like the parts of speach in a sentence).  You add these parts together and get a figure.

Before we start developing some graphics, we need to do a bit of package maintenance as `ggplot2` is not installed by default.

```{r ggplot_install, eval=FALSE}
install.packages("ggplot2")
library("ggplot2")
```

First thing we needt to do is to create our ggplot object.  Everything we do will build off of this object.  The bare minimum for this is the data (handily, `ggplot()` is expecting a data frame) and `aes()`, or the aesthetics layers.  Oddly (at least to me), this is the main place you specify your x and y data values.

```{r eval=FALSE}
# aes() are the "aesthetics" info.  When you simply add the x and y
# that can seem a bit of a confusing term.  You also use aes() to 
# change color, shape, size etc. of some items 
iris_gg<-ggplot(iris,aes(x=Petal.Length,y=Petal.Width))
```

Great, nothing happened...  All we did at this point is create an object that contains our data and what we want on the x and y axes.  We haven't said anything about what type of plot we want to make.  That comes next with the use of geometries.  

So if we want to simply plot a points we can add it to the ggplot object.  These are known as the geometries.  

A side note on syntax.  You will notice that we add new "things" to a ggplot object by adding new functions.  In concept this is very similar to the piping we talked about early.  Essentially it takes the output from the first function as the input to the second.  So to add points and create the plot, we would do:

```{r points_examp}
#Different syntax than you are used to
iris_gg + 
  geom_point()

#This too can be saved to an object
iris_scatter<-iris_gg +
                geom_point()

#Call it to create the plot
iris_scatter
```

Not appreciably better than base, in my opinion.  But what if we want to add some stuff...

First a title and some axes labels.  These are part of `labs()`.

```{r iris_labels}
iris_scatter<-iris_scatter +
                labs(title="Iris Petal Morphology Relationship",
                     x="Petal Length", y="Petal Width")
iris_scatter
```

Now to add some colors, shapes etc to the point.  Look at the `geom_point()` documentation for this.

```{r iris_colors}
iris_scatter<- iris_scatter +
                geom_point(aes(color=Species, shape=Species),size=5)
iris_scatter
```

Much easier that using base.  Now `ggplot2` really shines when you want to add stats (regression lines, intervals, etc.). 

Lets add a loess line with 95% confidence intervals

```{r iris_loess}
iris_scatter_loess<-iris_scatter +
                geom_smooth()
iris_scatter_loess
```

Try that in `base` with so little code!

Or we could add a simple linear regression line with:

```{r iris_lm}
iris_scatter_lm<-iris_scatter +
                  geom_smooth(method="lm")
iris_scatter_lm
```

And if we are interest in the regressions by group we could do it this way.

```{r iris_lm_groups}
iris_scatter_lm_group<-iris_scatter+
                        geom_smooth(method="lm", 
                                    aes(colour=Species,shape=Species))
iris_scatter_lm_group

```

You'll notice that I had to specify the aes again, but for `geom_smooth()`.  Since we only specified the x and y in to origin ggplot object, if want to do something different in the subsequent functions we need to overwrite it for the function in which we want a different mapping (i.e. groups ).

In short, while some of the intial setup for ggplot is a bit more verbose that base R, but when we want to do some more complex plots it is much easier in `ggplot2`.  

Before we get into another exercise, lets look at some of the other geometries.  In particular, boxplots, historgrams, and bar charts.  If you want to see all that you can do, take a look at the list of `ggplot2` [geom functions](http://docs.ggplot2.org/0.9.3.1/index.html).


###Boxplots
Boxplots will require us to specify only a single variable to plot.  A simple example would look like 

```{r box_examp}
ggplot(iris,aes(x=Species,y=Sepal.Width)) +
  geom_boxplot()
```

###Histograms

```{r hist_examp}
ggplot(iris,aes(x=Sepal.Width))+
  geom_histogram(binwidth=0.25)
```

###Barplots
Barplots can be done easily but often you want to plot a summary statistic (e.g. mean value) for different groups.  This requires setting up the data in the correct format first.  We can do that with `dplyr` first, then pass the result to `ggplot()`.

```{r bar_examp2}
iris_species_mean<-group_by(iris,Species) %>%
                    summarize(mean_pl=mean(Petal.Length))
iris_meanpl_bar<-ggplot(iris_species_mean,aes(x=Species,y=mean_pl))+
  geom_bar(stat="identity")
iris_meanpl_bar
```

##Exercise 1


So, none of these are spectacular yet, but with a bit more dithering, the plots would be publication ready.  Let's dig into this a bit more and talk about themes.



```{r eval=FALSE}
ggsave(plot=myBarChart,
       file="myBarChart.jpg")
```

#Sources of Help on `ggplot2`
- [Winston Chang's Cookbook](http://www.cookbook-r.com/Graphs/): Many great step-by-step examples.  Good starting point for you own plots
- [Offical `ggplot2` documentation](http://docs.ggplot2.org/current/): The authoritative source.  Also many great examples.

# R Data Viz Examples

- Base examples: [R Gallery]()
- ggplot examples: [Google Image Search](http://goo.gl/P0q2Lx)
- R Data Viz, gone wrong:[Accidental aRt](http://accidental-art.tumblr.com) 

